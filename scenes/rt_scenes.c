/**
 * Copyright (c) 2020, Evgeniy Morozov
 * All rights reserved.
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree.
 */
#include "rt_scenes.h"

#include <rt_weekend.h>

#include <rt_material.h>
#include <rt_hittable.h>
#include <rt_texture.h>
#include <rt_bvh.h>
#include <rt_aa_rect.h>
#include <rt_instance.h>
#include <string.h>
#include <assert.h>

rt_hittable_list_t *rt_scene_random(void)
{
    rt_material_t *ground_material =
        rt_mt_diffuse_new_with_texture(rt_texture_cp_new_with_colour(colour(0.2, 0.3, 0.1), colour(0.9, 0.9, 0.9)));

    rt_hittable_list_t *world = rt_hittable_list_init(500);
    rt_hittable_list_add(world, rt_sphere_new(point3(0, -1000, 0), 1000, ground_material));

    for (int a = -11; a < 11; a++)
    {
        for (int b = -11; b < 11; b++)
        {
            double material_chooser = rt_random_double(0, 1);
            point3_t center = vec3(a + 0.9 * rt_random_double(0, 1), 0.2, b + 0.9 * rt_random_double(0, 1));

            if (vec3_length(vec3_diff(center, point3(4, 0.2, 0))) > 0.9)
            {
                rt_hittable_t *object_to_add = NULL;
                rt_material_t *sphere_material = NULL;
                if (material_chooser < 0.8)
                {
                    colour_t albedo = vec3_multiply(vec3_random(0, 1), vec3_random(0, 1));
                    sphere_material = rt_mt_diffuse_new_with_albedo(albedo);
                    point3_t end_center = vec3_sum(center, vec3(0, rt_random_double(0, 0.5), 0));

                    object_to_add = rt_moving_sphere_new(center, end_center, 0.0, 1.0, 0.2, sphere_material);
                }
                else if (material_chooser < 0.95)
                {
                    colour_t albedo = vec3_random(0.5, 1);
                    double fuzz = rt_random_double(0, 0.5);
                    sphere_material = rt_mt_metal_new(albedo, fuzz);

                    object_to_add = rt_sphere_new(center, 0.2, sphere_material);
                }
                else
                {
                    sphere_material = rt_mt_dielectric_new(1.5);

                    object_to_add = rt_sphere_new(center, 0.2, sphere_material);
                }
                rt_hittable_list_add(world, object_to_add);
            }
        }
    }

    rt_material_t *material1 = rt_mt_dielectric_new(1.5);
    rt_hittable_list_add(world, rt_sphere_new(point3(0, 1, 0), 1.0, material1));

    rt_material_t *material2 = rt_mt_diffuse_new_with_albedo(colour(0.4, 0.2, 0.1));
    rt_hittable_list_add(world, rt_sphere_new(point3(-4, 1, 0), 1.0, material2));

    rt_material_t *material3 = rt_mt_metal_new(colour(0.7, 0.6, 0.5), 0.0);
    rt_hittable_list_add(world, rt_sphere_new(point3(4, 1, 0), 1.0, material3));

    rt_hittable_list_t *result = rt_hittable_list_init(1);
    rt_hittable_list_add(result, rt_bvh_node_new(world, 0.0, 1.0));

    rt_hittable_list_deinit(world);

    return result;
}

rt_hittable_list_t *rt_scene_two_spheres(void)
{
    rt_material_t *checker =
        rt_mt_diffuse_new_with_texture(rt_texture_cp_new_with_colour(colour(0.2, 0.3, 0.1), colour(0.9, 0.9, 0.9)));

    rt_hittable_list_t *objects = rt_hittable_list_init(2);

    rt_hittable_list_add(objects, rt_sphere_new(point3(0, -10, 0), 10, checker));
    rt_hittable_list_add(objects, rt_sphere_new(point3(0, 10, 0), 10, rt_material_claim(checker)));

    return objects;
}

rt_hittable_list_t *rt_scene_two_perlin_spheres(void)
{
    rt_material_t *noisy = rt_mt_diffuse_new_with_texture(rt_texture_noise_new(4));

    rt_hittable_list_t *objects = rt_hittable_list_init(2);

    rt_hittable_list_add(objects, rt_sphere_new(point3(0, -1000, 0), 1000, noisy));
    rt_hittable_list_add(objects, rt_sphere_new(point3(0, 2, 0), 2, rt_material_claim(noisy)));

    return objects;
}

rt_hittable_list_t *rt_scene_earth(void)
{
    rt_material_t *earth_material =
        rt_mt_diffuse_new_with_texture(rt_texture_image_new("assets/textures/earth_projection.jpg"));

    rt_hittable_list_t *objects = rt_hittable_list_init(1);

    rt_hittable_list_add(objects, rt_sphere_new(point3(0, 0, 0), 2, earth_material));

    return objects;
}

rt_hittable_list_t *rt_scene_light_sample(void)
{
    rt_material_t *noisy = rt_mt_diffuse_new_with_texture(rt_texture_noise_new(4));

    rt_hittable_list_t *objects = rt_hittable_list_init(3);

    rt_hittable_list_add(objects, rt_sphere_new(point3(0, -1000, 0), 1000, noisy));
    rt_hittable_list_add(objects, rt_sphere_new(point3(0, 2, 0), 2, rt_material_claim(noisy)));

    rt_material_t *diffuse_light = rt_mt_dl_new_with_albedo(colour(0.7, 0.8, 0.6), 4);
    rt_hittable_list_add(objects, rt_aa_rect_new_xy(3, 5, 1, 3, -2, diffuse_light));

    return objects;
}

rt_hittable_list_t *rt_scene_cornell_box(void)
{
    rt_hittable_list_t *objects = rt_hittable_list_init(8);

    rt_material_t *red = rt_mt_diffuse_new_with_albedo(colour(0.65, 0.05, 0.05));
    rt_material_t *green = rt_mt_diffuse_new_with_albedo(colour(0.12, 0.45, 0.15));
    rt_material_t *white = rt_mt_diffuse_new_with_albedo(colour(0.73, 0.73, 0.73));

    // Walls
    rt_hittable_list_add(objects, rt_aa_rect_new_yz(0, 555, 0, 555, 555, green));
    rt_hittable_list_add(objects, rt_aa_rect_new_yz(0, 555, 0, 555, 0, red));

    rt_hittable_list_add(objects, rt_aa_rect_new_xz(0, 555, 0, 555, 0, white));
    rt_hittable_list_add(objects, rt_aa_rect_new_xz(0, 555, 0, 555, 555, rt_material_claim(white)));
    rt_hittable_list_add(objects, rt_aa_rect_new_xy(0, 555, 0, 555, 555, rt_material_claim(white)));
    // Boxes
    rt_hittable_t *box1 = rt_instance_new(rt_box_new(point3(0, 0, 0), point3(165, 330, 165), rt_material_claim(white)));
    rt_instance_rotate_y(box1, 15);
    rt_instance_translate(box1, vec3(265, 0, 295));
    rt_hittable_list_add(objects, box1);

    rt_hittable_t *box2 = rt_instance_new(rt_box_new(point3(0, 0, 0), point3(165, 165, 165), rt_material_claim(white)));
    rt_instance_rotate_y(box2, -18);
    rt_instance_translate(box2, vec3(130, 0, 65));
    rt_hittable_list_add(objects, box2);

    // Light source
    rt_material_t *diffuse_light = rt_mt_dl_new_with_albedo(colour(1, 1, 1), 15);
    rt_hittable_list_add(objects, rt_aa_rect_new_xz(213, 343, 227, 332, 554, diffuse_light));

    rt_hittable_list_t *result = rt_hittable_list_init(1);
    rt_hittable_list_add(result, rt_bvh_node_new(objects, 0, 1));

    rt_hittable_list_deinit(objects);

    return result;
}

rt_hittable_list_t *rt_scene_instance_test(void)
{
    rt_material_t *green = rt_mt_diffuse_new_with_albedo(colour(0.12, 0.45, 0.15));
    rt_material_t *red = rt_mt_diffuse_new_with_albedo(colour(0.65, 0.05, 0.05));

    rt_hittable_list_t *objects = rt_hittable_list_init(2);

    rt_hittable_t *box = rt_box_new(point3(-1, -1, -1), point3(1, 1, 1), green);
    rt_hittable_t *instance = rt_instance_new(box);
    rt_instance_rotate_y(instance, 45);
    rt_instance_translate(instance, point3(1, 0, 0.1));

    rt_hittable_list_add(objects, instance);
    rt_hittable_list_add(objects, rt_box_new(point3(-0.25, -0.25, -0.25), point3(0.25, 0.25, 0.25), red));

    rt_hittable_list_t *result = rt_hittable_list_init(1);
    rt_hittable_list_add(result, rt_bvh_node_new(objects, 0, 1));

    rt_hittable_list_deinit(objects);

    return result;
}

rt_hittable_list_t *rt_scene_cornell_box_smoke_boxes(void)
{
    rt_hittable_list_t *objects = rt_hittable_list_init(8);

    rt_material_t *red = rt_mt_diffuse_new_with_albedo(colour(0.65, 0.05, 0.05));
    rt_material_t *green = rt_mt_diffuse_new_with_albedo(colour(0.12, 0.45, 0.15));
    rt_material_t *white = rt_mt_diffuse_new_with_albedo(colour(0.73, 0.73, 0.73));

    // Walls
    rt_hittable_list_add(objects, rt_aa_rect_new_yz(0, 555, 0, 555, 555, green));
    rt_hittable_list_add(objects, rt_aa_rect_new_yz(0, 555, 0, 555, 0, red));

    rt_hittable_list_add(objects, rt_aa_rect_new_xz(0, 555, 0, 555, 0, white));
    rt_hittable_list_add(objects, rt_aa_rect_new_xz(0, 555, 0, 555, 555, rt_material_claim(white)));
    rt_hittable_list_add(objects, rt_aa_rect_new_xy(0, 555, 0, 555, 555, rt_material_claim(white)));
    // Boxes
    rt_hittable_t *box1 = rt_instance_new(rt_box_new(point3(0, 0, 0), point3(165, 330, 165), rt_material_claim(white)));
    rt_instance_rotate_y(box1, 15);
    rt_instance_translate(box1, vec3(265, 0, 295));
    rt_hittable_list_add(objects, rt_const_medium_new_with_colour(box1, 0.01, colour(0.0, 0.0, 0.0)));

    rt_hittable_t *box2 = rt_instance_new(rt_box_new(point3(0, 0, 0), point3(165, 165, 165), rt_material_claim(white)));
    rt_instance_rotate_y(box2, -18);
    rt_instance_translate(box2, vec3(130, 0, 65));
    rt_hittable_list_add(objects, rt_const_medium_new_with_colour(box2, 0.01, colour(1.0, 1.0, 1.0)));

    // Light source
    rt_material_t *diffuse_light = rt_mt_dl_new_with_albedo(colour(1, 1, 1), 7);
    rt_hittable_list_add(objects, rt_aa_rect_new_xz(113, 443, 127, 432, 554, diffuse_light));

    rt_hittable_t *bvh = rt_bvh_node_new(objects, 0, 1);
    rt_hittable_list_t *result = rt_hittable_list_init(1);
    rt_hittable_list_add(result, bvh);

    rt_hittable_list_deinit(objects);

    return result;
}

rt_hittable_list_t *rt_scene_showcase(void)
{
    const int BOXES_PER_SIDE = 20;

    // Add ground boxes
    rt_hittable_list_t *ground_boxes = rt_hittable_list_init(BOXES_PER_SIDE * BOXES_PER_SIDE);
    rt_material_t *ground = rt_mt_diffuse_new_with_albedo(colour(0.48, 0.83, 0.53));

    for (int i = 0; i < BOXES_PER_SIDE; ++i)
    {
        for (int j = 0; j < BOXES_PER_SIDE; ++j)
        {
            double w = 100.0;
            double x0 = -1000.0 + i * w;
            double z0 = -1000.0 + j * w;
            double y0 = 0.0;
            double x1 = x0 + w;
            double y1 = rt_random_double(1, 101);
            double z1 = z0 + w;

            rt_hittable_list_add(ground_boxes,
                                 rt_box_new(point3(x0, y0, z0), point3(x1, y1, z1), rt_material_claim(ground)));
        }
    }

    rt_hittable_list_t *objects = rt_hittable_list_init(40);
    rt_hittable_list_add(objects, rt_bvh_node_new(ground_boxes, 0, 1));

    // Add a light source
    rt_material_t *light = rt_mt_dl_new_with_albedo(colour(1, 1, 1), 7);
    rt_hittable_list_add(objects, rt_aa_rect_new_xz(123, 423, 147, 412, 554, light));

    // Add a moving sphere
    point3_t center1 = point3(400, 400, 200);
    point3_t center2 = vec3_sum(center1, vec3(30, 0, 0));

    rt_material_t *moving_sphere_material = rt_mt_diffuse_new_with_albedo(colour(0.7, 0.3, 0.1));
    rt_hittable_list_add(objects, rt_moving_sphere_new(center1, center2, 0, 1, 50, moving_sphere_material));

    // Add glass sphere
    rt_hittable_list_add(objects, rt_sphere_new(point3(260, 150, 45), 50, rt_mt_dielectric_new(1.5)));

    // Add metal sphere
    rt_hittable_t *metal_sphere = rt_sphere_new(point3(0, 150, 145), 50, rt_mt_metal_new(colour(0.8, 0.8, 0.9), 1.0));
    rt_hittable_list_add(objects, metal_sphere);

    // Sphere with glossy surface and fog inside
    rt_hittable_t *boundary = rt_sphere_new(point3(360, 150, 145), 70, rt_mt_dielectric_new(1.5));
    rt_hittable_list_add(objects, boundary);
    rt_hittable_list_add(objects,
                         rt_const_medium_new_with_colour(rt_hittable_claim(boundary), 0.2, colour(0.2, 0.4, 0.9)));

    // Global fog and distortion
    boundary = rt_sphere_new(point3(0, 0, 0), 5000, rt_mt_dielectric_new(1.5));
    rt_hittable_list_add(objects, rt_const_medium_new_with_colour(boundary, 0.0001, colour(1, 1, 1)));

    // Add Earth
    rt_material_t *earth = rt_mt_diffuse_new_with_texture(rt_texture_image_new("assets/textures/earth_projection.jpg"));
    rt_hittable_list_add(objects, rt_sphere_new(point3(400, 200, 400), 100, earth));

    // Add Perlin noise texture
    rt_texture_t *perlin = rt_texture_noise_new(0.1);
    rt_hittable_list_add(objects, rt_sphere_new(point3(220, 280, 300), 80, rt_mt_diffuse_new_with_texture(perlin)));

    const int NUMBER_OF_SPHERES = 1000;
    rt_hittable_list_t *spheres = rt_hittable_list_init(NUMBER_OF_SPHERES);
    rt_material_t *white = rt_mt_diffuse_new_with_albedo(colour(.73, .73, .73));

    for (int i = 0; i < NUMBER_OF_SPHERES; ++i)
    {
        rt_hittable_list_add(spheres, rt_sphere_new(vec3_random(0, 165), 10, rt_material_claim(white)));
    }

    rt_hittable_t *spheres_instance = rt_instance_new(rt_bvh_node_new(spheres, 0, 1));
    rt_instance_rotate_y(spheres_instance, 15);
    rt_instance_translate(spheres_instance, point3(-100, 270, 395));
    rt_hittable_list_add(objects, spheres_instance);

    rt_material_delete(white);
    rt_material_delete(ground);
    rt_hittable_list_deinit(ground_boxes);
    rt_hittable_list_deinit(spheres);

    return objects;
}

rt_hittable_list_t *rt_scene_metal_test(void)
{
    rt_material_t *checker =
        rt_mt_diffuse_new_with_texture(rt_texture_cp_new_with_colour(colour(0.2, 0.3, 0.1), colour(0.9, 0.9, 0.9)));

    rt_hittable_list_t *objects = rt_hittable_list_init(5);

    rt_hittable_list_add(objects, rt_sphere_new(point3(0, -1000, 0), 1000, checker));

    rt_hittable_list_add(objects, rt_sphere_new(point3(-2, 2, 0), 1, rt_mt_metal_new(colour(0.8, 0.8, 0.9), 0.0)));
    rt_hittable_list_add(objects, rt_sphere_new(point3(0, 2, 0), 1, rt_mt_dielectric_new(1.5)));
    rt_hittable_list_add(objects, rt_sphere_new(point3(2, 2, 0), 1, rt_mt_metal_new(colour(0.8, 0.8, 0.9), 1.0)));

    rt_hittable_t *box_instance =
        rt_instance_new(rt_box_new(point3(-1, -1, -1), point3(1, 1, 1), rt_mt_metal_new(colour(0.8, 0.8, 0.9), 0.0)));
    rt_instance_rotate_y(box_instance, 45);
    rt_instance_translate(box_instance, vec3(2, 1, 11));
    rt_hittable_list_add(objects, box_instance);

    return objects;
}

rt_hittable_list_t *rt_scene_triangle_test(void)
{
    rt_material_t *green = rt_mt_diffuse_new_with_albedo(colour(0.12, 0.45, 0.15));
    rt_material_t *floor_mat =
        rt_mt_diffuse_new_with_texture(rt_texture_cp_new_with_colour(colour(0.2, 0.3, 0.1), colour(0.9, 0.9, 0.9)));
    rt_material_t *mirror = rt_mt_metal_new(colour(0.7, 0.6, 0.5), 0.0);
    rt_material_t *glass = rt_mt_dielectric_new(1.01);

    rt_hittable_list_t *objects = rt_hittable_list_init(10);

    rt_hittable_t *floor = rt_aa_rect_new_xz(-10, 10, -10, 10, -2, floor_mat);
    rt_hittable_list_add(objects, floor);

    rt_hittable_t *side =
        rt_triangle_new(point3(-2, -2, 0), point3(2, -2, 0), point3(-2, 1, 0), rt_material_claim(mirror));
    rt_hittable_list_add(objects, side);
    side = rt_triangle_new(point3(-2, 1, 0), point3(2, -2, 0), point3(2, 1, 0), rt_material_claim(mirror));
    rt_hittable_list_add(objects, side);

    // Suzanne model from Blender
    // clang-format off
    point3_t vertices[] = {
        -0.4375, 0.1640625, -0.765625, 0.4375, 0.1640625, -0.765625, -0.5, 0.09375, -0.6875, 0.5, 0.09375, -0.6875, -0.546875, 0.0546875, -0.578125, 0.546875, 0.0546875, -0.578125, -0.3515625, -0.0234375, -0.6171875, 0.3515625, -0.0234375, -0.6171875, -0.3515625, 0.03125, -0.71875, 0.3515625, 0.03125, -0.71875, -0.3515625, 0.1328125, -0.78125, 0.3515625, 0.1328125, -0.78125, -0.2734375, 0.1640625, -0.796875, 0.2734375, 0.1640625, -0.796875, -0.203125, 0.09375, -0.7421875, 0.203125, 0.09375, -0.7421875, -0.15625, 0.0546875, -0.6484375, 0.15625, 0.0546875, -0.6484375, -0.078125, 0.2421875, -0.65625, 0.078125, 0.2421875, -0.65625, -0.140625, 0.2421875, -0.7421875, 0.140625, 0.2421875, -0.7421875, -0.2421875, 0.2421875, -0.796875, 0.2421875, 0.2421875, -0.796875, -0.2734375, 0.328125, -0.796875, 0.2734375, 0.328125, -0.796875, -0.203125, 0.390625, -0.7421875, 0.203125, 0.390625, -0.7421875, -0.15625, 0.4375, -0.6484375, 0.15625, 0.4375, -0.6484375, -0.3515625, 0.515625, -0.6171875, 0.3515625, 0.515625, -0.6171875, -0.3515625, 0.453125, -0.71875, 0.3515625, 0.453125, -0.71875, -0.3515625, 0.359375, -0.78125, 0.3515625, 0.359375, -0.78125, -0.4375, 0.328125, -0.765625, 0.4375, 0.328125, -0.765625, -0.5, 0.390625, -0.6875, 0.5, 0.390625, -0.6875, -0.546875, 0.4375, -0.578125, 0.546875, 0.4375, -0.578125, -0.625, 0.2421875, -0.5625, 0.625, 0.2421875, -0.5625, -0.5625, 0.2421875, -0.671875, 0.5625, 0.2421875, -0.671875, -0.46875, 0.2421875, -0.7578125, 0.46875, 0.2421875, -0.7578125, -0.4765625, 0.2421875, -0.7734375, 0.4765625, 0.2421875, -0.7734375, -0.4453125, 0.3359375, -0.78125, 0.4453125, 0.3359375, -0.78125, -0.3515625, 0.375, -0.8046875, 0.3515625, 0.375, -0.8046875, -0.265625, 0.3359375, -0.8203125, 0.265625, 0.3359375, -0.8203125, -0.2265625, 0.2421875, -0.8203125, 0.2265625, 0.2421875, -0.8203125, -0.265625, 0.15625, -0.8203125, 0.265625, 0.15625, -0.8203125, -0.3515625, 0.2421875, -0.828125, 0.3515625, 0.2421875, -0.828125, -0.3515625, 0.1171875, -0.8046875, 0.3515625, 0.1171875, -0.8046875, -0.4453125, 0.15625, -0.78125, 0.4453125, 0.15625, -0.78125, 0, 0.4296875, -0.7421875, 0, 0.3515625, -0.8203125, 0, -0.6796875, -0.734375, 0, -0.3203125, -0.78125, 0, -0.1875, -0.796875, 0, -0.7734375, -0.71875, 0, 0.40625, -0.6015625, 0, 0.5703125, -0.5703125, 0, 0.8984375, 0.546875, 0, 0.5625, 0.8515625, 0, 0.0703125, 0.828125, 0, -0.3828125, 0.3515625, -0.203125, -0.1875, -0.5625, 0.203125, -0.1875, -0.5625, -0.3125, -0.4375, -0.5703125, 0.3125, -0.4375, -0.5703125, -0.3515625, -0.6953125, -0.5703125, 0.3515625, -0.6953125, -0.5703125, -0.3671875, -0.890625, -0.53125, 0.3671875, -0.890625, -0.53125, -0.328125, -0.9453125, -0.5234375, 0.328125, -0.9453125, -0.5234375, -0.1796875, -0.96875, -0.5546875, 0.1796875, -0.96875, -0.5546875, 0, -0.984375, -0.578125, -0.4375, -0.140625, -0.53125, 0.4375, -0.140625, -0.53125, -0.6328125, -0.0390625, -0.5390625, 0.6328125, -0.0390625, -0.5390625, -0.828125, 0.1484375, -0.4453125, 0.828125, 0.1484375, -0.4453125, -0.859375, 0.4296875, -0.59375, 0.859375, 0.4296875, -0.59375, -0.7109375, 0.484375, -0.625, 0.7109375, 0.484375, -0.625, -0.4921875, 0.6015625, -0.6875, 0.4921875, 0.6015625, -0.6875, -0.3203125, 0.7578125, -0.734375, 0.3203125, 0.7578125, -0.734375, -0.15625, 0.71875, -0.7578125, 0.15625, 0.71875, -0.7578125, -0.0625, 0.4921875, -0.75, 0.0625, 0.4921875, -0.75, -0.1640625, 0.4140625, -0.7734375, 0.1640625, 0.4140625, -0.7734375, -0.125, 0.3046875, -0.765625, 0.125, 0.3046875, -0.765625, -0.203125, 0.09375, -0.7421875, 0.203125, 0.09375, -0.7421875, -0.375, 0.015625, -0.703125, 0.375, 0.015625, -0.703125, -0.4921875, 0.0625, -0.671875, 0.4921875, 0.0625, -0.671875, -0.625, 0.1875, -0.6484375, 0.625, 0.1875, -0.6484375, -0.640625, 0.296875, -0.6484375, 0.640625, 0.296875, -0.6484375, -0.6015625, 0.375, -0.6640625, 0.6015625, 0.375, -0.6640625, -0.4296875, 0.4375, -0.71875, 0.4296875, 0.4375, -0.71875, -0.25, 0.46875, -0.7578125, 0.25, 0.46875, -0.7578125, 0, -0.765625, -0.734375, -0.109375, -0.71875, -0.734375, 0.109375, -0.71875, -0.734375, -0.1171875, -0.8359375, -0.7109375, 0.1171875, -0.8359375, -0.7109375, -0.0625, -0.8828125, -0.6953125, 0.0625, -0.8828125, -0.6953125, 0, -0.890625, -0.6875, 0, -0.1953125, -0.75, 0, -0.140625, -0.7421875, -0.1015625, -0.1484375, -0.7421875, 0.1015625, -0.1484375, -0.7421875, -0.125, -0.2265625, -0.75, 0.125, -0.2265625, -0.75, -0.0859375, -0.2890625, -0.7421875, 0.0859375, -0.2890625, -0.7421875, -0.3984375, -0.046875, -0.671875, 0.3984375, -0.046875, -0.671875, -0.6171875, 0.0546875, -0.625, 0.6171875, 0.0546875, -0.625, -0.7265625, 0.203125, -0.6015625, 0.7265625, 0.203125, -0.6015625, -0.7421875, 0.375, -0.65625, 0.7421875, 0.375, -0.65625, -0.6875, 0.4140625, -0.7265625, 0.6875, 0.4140625, -0.7265625, -0.4375, 0.546875, -0.796875, 0.4375, 0.546875, -0.796875, -0.3125, 0.640625, -0.8359375, 0.3125, 0.640625, -0.8359375, -0.203125, 0.6171875, -0.8515625, 0.203125, 0.6171875, -0.8515625, -0.1015625, 0.4296875, -0.84375, 0.1015625, 0.4296875, -0.84375, -0.125, -0.1015625, -0.8125, 0.125, -0.1015625, -0.8125, -0.2109375, -0.4453125, -0.7109375, 0.2109375, -0.4453125, -0.7109375, -0.25, -0.703125, -0.6875, 0.25, -0.703125, -0.6875, -0.265625, -0.8203125, -0.6640625, 0.265625, -0.8203125, -0.6640625, -0.234375, -0.9140625, -0.6328125, 0.234375, -0.9140625, -0.6328125, -0.1640625, -0.9296875, -0.6328125, 0.1640625, -0.9296875, -0.6328125, 0, -0.9453125, -0.640625, 0, 0.046875, -0.7265625, 0, 0.2109375, -0.765625, -0.328125, 0.4765625, -0.7421875, 0.328125, 0.4765625, -0.7421875, -0.1640625, 0.140625, -0.75, 0.1640625, 0.140625, -0.75, -0.1328125, 0.2109375, -0.7578125, 0.1328125, 0.2109375, -0.7578125, -0.1171875, -0.6875, -0.734375, 0.1171875, -0.6875, -0.734375, -0.078125, -0.4453125, -0.75, 0.078125, -0.4453125, -0.75, 0, -0.4453125, -0.75, 0, -0.328125, -0.7421875, -0.09375, -0.2734375, -0.78125, 0.09375, -0.2734375, -0.78125, -0.1328125, -0.2265625, -0.796875, 0.1328125, -0.2265625, -0.796875, -0.109375, -0.1328125, -0.78125, 0.109375, -0.1328125, -0.78125, -0.0390625, -0.125, -0.78125, 0.0390625, -0.125, -0.78125, 0, -0.203125, -0.828125, -0.046875, -0.1484375, -0.8125, 0.046875, -0.1484375, -0.8125, -0.09375, -0.15625, -0.8125, 0.09375, -0.15625, -0.8125, -0.109375, -0.2265625, -0.828125, 0.109375, -0.2265625, -0.828125, -0.078125, -0.25, -0.8046875, 0.078125, -0.25, -0.8046875, 0, -0.2890625, -0.8046875, -0.2578125, -0.3125, -0.5546875, 0.2578125, -0.3125, -0.5546875, -0.1640625, -0.2421875, -0.7109375, 0.1640625, -0.2421875, -0.7109375, -0.1796875, -0.3125, -0.7109375, 0.1796875, -0.3125, -0.7109375, -0.234375, -0.25, -0.5546875, 0.234375, -0.25, -0.5546875, 0, -0.875, -0.6875, -0.046875, -0.8671875, -0.6875, 0.046875, -0.8671875, -0.6875, -0.09375, -0.8203125, -0.7109375, 0.09375, -0.8203125, -0.7109375, -0.09375, -0.7421875, -0.7265625, 0.09375, -0.7421875, -0.7265625, 0, -0.78125, -0.65625, -0.09375, -0.75, -0.6640625, 0.09375, -0.75, -0.6640625, -0.09375, -0.8125, -0.640625, 0.09375, -0.8125, -0.640625, -0.046875, -0.8515625, -0.6328125, 0.046875, -0.8515625, -0.6328125, 0, -0.859375, -0.6328125, -0.171875, 0.21875, -0.78125, 0.171875, 0.21875, -0.78125, -0.1875, 0.15625, -0.7734375, 0.1875, 0.15625, -0.7734375, -0.3359375, 0.4296875, -0.7578125, 0.3359375, 0.4296875, -0.7578125, -0.2734375, 0.421875, -0.7734375, 0.2734375, 0.421875, -0.7734375, -0.421875, 0.3984375, -0.7734375, 0.421875, 0.3984375, -0.7734375, -0.5625, 0.3515625, -0.6953125, 0.5625, 0.3515625, -0.6953125, -0.5859375, 0.2890625, -0.6875, 0.5859375, 0.2890625, -0.6875, -0.578125, 0.1953125, -0.6796875, 0.578125, 0.1953125, -0.6796875, -0.4765625, 0.1015625, -0.71875, 0.4765625, 0.1015625, -0.71875, -0.375, 0.0625, -0.7421875, 0.375, 0.0625, -0.7421875, -0.2265625, 0.109375, -0.78125, 0.2265625, 0.109375, -0.78125, -0.1796875, 0.296875, -0.78125, 0.1796875, 0.296875, -0.78125, -0.2109375, 0.375, -0.78125, 0.2109375, 0.375, -0.78125, -0.234375, 0.359375, -0.7578125, 0.234375, 0.359375, -0.7578125, -0.1953125, 0.296875, -0.7578125, 0.1953125, 0.296875, -0.7578125, -0.2421875, 0.125, -0.7578125, 0.2421875, 0.125, -0.7578125, -0.375, 0.0859375, -0.7265625, 0.375, 0.0859375, -0.7265625, -0.4609375, 0.1171875, -0.703125, 0.4609375, 0.1171875, -0.703125, -0.546875, 0.2109375, -0.671875, 0.546875, 0.2109375, -0.671875, -0.5546875, 0.28125, -0.671875, 0.5546875, 0.28125, -0.671875, -0.53125, 0.3359375, -0.6796875, 0.53125, 0.3359375, -0.6796875, -0.4140625, 0.390625, -0.75, 0.4140625, 0.390625, -0.75, -0.28125, 0.3984375, -0.765625, 0.28125, 0.3984375, -0.765625, -0.3359375, 0.40625, -0.75, 0.3359375, 0.40625, -0.75, -0.203125, 0.171875, -0.75, 0.203125, 0.171875, -0.75, -0.1953125, 0.2265625, -0.75, 0.1953125, 0.2265625, -0.75, -0.109375, 0.4609375, -0.609375, 0.109375, 0.4609375, -0.609375, -0.1953125, 0.6640625, -0.6171875, 0.1953125, 0.6640625, -0.6171875, -0.3359375, 0.6875, -0.59375, 0.3359375, 0.6875, -0.59375, -0.484375, 0.5546875, -0.5546875, 0.484375, 0.5546875, -0.5546875, -0.6796875, 0.453125, -0.4921875, 0.6796875, 0.453125, -0.4921875, -0.796875, 0.40625, -0.4609375, 0.796875, 0.40625, -0.4609375, -0.7734375, 0.1640625, -0.375, 0.7734375, 0.1640625, -0.375, -0.6015625, 0, -0.4140625, 0.6015625, 0, -0.4140625, -0.4375, -0.09375, -0.46875, 0.4375, -0.09375, -0.46875, 0, 0.8984375, -0.2890625, 0, 0.984375, 0.078125, 0, -0.1953125, 0.671875, 0, -0.4609375, -0.1875, 0, -0.9765625, -0.4609375, 0, -0.8046875, -0.34375, 0, -0.5703125, -0.3203125, 0, -0.484375, -0.28125, -0.8515625, 0.234375, -0.0546875, 0.8515625, 0.234375, -0.0546875, -0.859375, 0.3203125, 0.046875, 0.859375, 0.3203125, 0.046875, -0.7734375, 0.265625, 0.4375, 0.7734375, 0.265625, 0.4375, -0.4609375, 0.4375, 0.703125, 0.4609375, 0.4375, 0.703125, -0.734375, -0.046875, -0.0703125, 0.734375, -0.046875, -0.0703125, -0.59375, -0.125, 0.1640625, 0.59375, -0.125, 0.1640625, -0.640625, -0.0078125, 0.4296875, 0.640625, -0.0078125, 0.4296875, -0.3359375, 0.0546875, 0.6640625, 0.3359375, 0.0546875, 0.6640625, -0.234375, -0.3515625, -0.40625, 0.234375, -0.3515625, -0.40625, -0.1796875, -0.4140625, -0.2578125, 0.1796875, -0.4140625, -0.2578125, -0.2890625, -0.7109375, -0.3828125, 0.2890625, -0.7109375, -0.3828125, -0.25, -0.5, -0.390625, 0.25, -0.5, -0.390625, -0.328125, -0.9140625, -0.3984375, 0.328125, -0.9140625, -0.3984375, -0.140625, -0.7578125, -0.3671875, 0.140625, -0.7578125, -0.3671875, -0.125, -0.5390625, -0.359375, 0.125, -0.5390625, -0.359375, -0.1640625, -0.9453125, -0.4375, 0.1640625, -0.9453125, -0.4375, -0.21875, -0.28125, -0.4296875, 0.21875, -0.28125, -0.4296875, -0.2109375, -0.2265625, -0.46875, 0.2109375, -0.2265625, -0.46875, -0.203125, -0.171875, -0.5, 0.203125, -0.171875, -0.5, -0.2109375, -0.390625, -0.1640625, 0.2109375, -0.390625, -0.1640625, -0.296875, -0.3125, 0.265625, 0.296875, -0.3125, 0.265625, -0.34375, -0.1484375, 0.5390625, 0.34375, -0.1484375, 0.5390625, -0.453125, 0.8671875, 0.3828125, 0.453125, 0.8671875, 0.3828125, -0.453125, 0.9296875, 0.0703125, 0.453125, 0.9296875, 0.0703125, -0.453125, 0.8515625, -0.234375, 0.453125, 0.8515625, -0.234375, -0.4609375, 0.5234375, -0.4296875, 0.4609375, 0.5234375, -0.4296875, -0.7265625, 0.40625, -0.3359375, 0.7265625, 0.40625, -0.3359375, -0.6328125, 0.453125, -0.28125, 0.6328125, 0.453125, -0.28125, -0.640625, 0.703125, -0.0546875, 0.640625, 0.703125, -0.0546875, -0.796875, 0.5625, -0.125, 0.796875, 0.5625, -0.125, -0.796875, 0.6171875, 0.1171875, 0.796875, 0.6171875, 0.1171875, -0.640625, 0.75, 0.1953125, 0.640625, 0.75, 0.1953125, -0.640625, 0.6796875, 0.4453125, 0.640625, 0.6796875, 0.4453125, -0.796875, 0.5390625, 0.359375, 0.796875, 0.5390625, 0.359375, -0.6171875, 0.328125, 0.5859375, 0.6171875, 0.328125, 0.5859375, -0.484375, 0.0234375, 0.546875, 0.484375, 0.0234375, 0.546875, -0.8203125, 0.328125, 0.203125, 0.8203125, 0.328125, 0.203125, -0.40625, -0.171875, -0.1484375, 0.40625, -0.171875, -0.1484375, -0.4296875, -0.1953125, 0.2109375, 0.4296875, -0.1953125, 0.2109375, -0.890625, 0.40625, 0.234375, 0.890625, 0.40625, 0.234375, -0.7734375, -0.140625, 0.125, 0.7734375, -0.140625, 0.125, -1.039062, -0.1015625, 0.328125, 1.039062, -0.1015625, 0.328125, -1.28125, 0.0546875, 0.4296875, 1.28125, 0.0546875, 0.4296875, -1.351562, 0.3203125, 0.421875, 1.351562, 0.3203125, 0.421875, -1.234375, 0.5078125, 0.421875, 1.234375, 0.5078125, 0.421875, -1.023437, 0.4765625, 0.3125, 1.023437, 0.4765625, 0.3125, -1.015625, 0.4140625, 0.2890625, 1.015625, 0.4140625, 0.2890625, -1.1875, 0.4375, 0.390625, 1.1875, 0.4375, 0.390625, -1.265625, 0.2890625, 0.40625, 1.265625, 0.2890625, 0.40625, -1.210937, 0.078125, 0.40625, 1.210937, 0.078125, 0.40625, -1.03125, -0.0390625, 0.3046875, 1.03125, -0.0390625, 0.3046875, -0.828125, -0.0703125, 0.1328125, 0.828125, -0.0703125, 0.1328125, -0.921875, 0.359375, 0.21875, 0.921875, 0.359375, 0.21875, -0.9453125, 0.3046875, 0.2890625, 0.9453125, 0.3046875, 0.2890625, -0.8828125, -0.0234375, 0.2109375, 0.8828125, -0.0234375, 0.2109375, -1.039062, 0, 0.3671875, 1.039062, 0, 0.3671875, -1.1875, 0.09375, 0.4453125, 1.1875, 0.09375, 0.4453125, -1.234375, 0.25, 0.4453125, 1.234375, 0.25, 0.4453125, -1.171875, 0.359375, 0.4375, 1.171875, 0.359375, 0.4375, -1.023437, 0.34375, 0.359375, 1.023437, 0.34375, 0.359375, -0.84375, 0.2890625, 0.2109375, 0.84375, 0.2890625, 0.2109375, -0.8359375, 0.171875, 0.2734375, 0.8359375, 0.171875, 0.2734375, -0.7578125, 0.09375, 0.2734375, 0.7578125, 0.09375, 0.2734375, -0.8203125, 0.0859375, 0.2734375, 0.8203125, 0.0859375, 0.2734375, -0.84375, 0.015625, 0.2734375, 0.84375, 0.015625, 0.2734375, -0.8125, -0.015625, 0.2734375, 0.8125, -0.015625, 0.2734375, -0.7265625, 0, 0.0703125, 0.7265625, 0, 0.0703125, -0.71875, -0.0234375, 0.171875, 0.71875, -0.0234375, 0.171875, -0.71875, 0.0390625, 0.1875, 0.71875, 0.0390625, 0.1875, -0.796875, 0.203125, 0.2109375, 0.796875, 0.203125, 0.2109375, -0.890625, 0.2421875, 0.265625, 0.890625, 0.2421875, 0.265625, -0.890625, 0.234375, 0.3203125, 0.890625, 0.234375, 0.3203125, -0.8125, -0.015625, 0.3203125, 0.8125, -0.015625, 0.3203125, -0.8515625, 0.015625, 0.3203125, 0.8515625, 0.015625, 0.3203125, -0.828125, 0.078125, 0.3203125, 0.828125, 0.078125, 0.3203125, -0.765625, 0.09375, 0.3203125, 0.765625, 0.09375, 0.3203125, -0.84375, 0.171875, 0.3203125, 0.84375, 0.171875, 0.3203125, -1.039062, 0.328125, 0.4140625, 1.039062, 0.328125, 0.4140625, -1.1875, 0.34375, 0.484375, 1.1875, 0.34375, 0.484375, -1.257812, 0.2421875, 0.4921875, 1.257812, 0.2421875, 0.4921875, -1.210937, 0.0859375, 0.484375, 1.210937, 0.0859375, 0.484375, -1.046875, 0, 0.421875, 1.046875, 0, 0.421875, -0.8828125, -0.015625, 0.265625, 0.8828125, -0.015625, 0.265625, -0.953125, 0.2890625, 0.34375, 0.953125, 0.2890625, 0.34375, -0.890625, 0.109375, 0.328125, 0.890625, 0.109375, 0.328125, -0.9375, 0.0625, 0.3359375, 0.9375, 0.0625, 0.3359375, -1, 0.125, 0.3671875, 1, 0.125, 0.3671875, -0.9609375, 0.171875, 0.3515625, 0.9609375, 0.171875, 0.3515625, -1.015625, 0.234375, 0.375, 1.015625, 0.234375, 0.375, -1.054687, 0.1875, 0.3828125, 1.054687, 0.1875, 0.3828125, -1.109375, 0.2109375, 0.390625, 1.109375, 0.2109375, 0.390625, -1.085937, 0.2734375, 0.390625, 1.085937, 0.2734375, 0.390625, -1.023437, 0.4375, 0.484375, 1.023437, 0.4375, 0.484375, -1.25, 0.46875, 0.546875, 1.25, 0.46875, 0.546875, -1.367187, 0.296875, 0.5, 1.367187, 0.296875, 0.5, -1.3125, 0.0546875, 0.53125, 1.3125, 0.0546875, 0.53125, -1.039062, -0.0859375, 0.4921875, 1.039062, -0.0859375, 0.4921875, -0.7890625, -0.125, 0.328125, 0.7890625, -0.125, 0.328125, -0.859375, 0.3828125, 0.3828125, 0.859375, 0.3828125, 0.3828125
    };
    size_t triangle_count = 967;
    size_t triangles[] = {46, 2, 44, 3, 47, 45, 44, 4, 42, 5, 45, 43, 2, 6, 4, 7, 3, 5, 0, 8, 2, 9, 1, 3, 10, 14, 8, 15, 11, 9, 8, 16, 6, 17, 9, 7, 20, 16, 14, 21, 17, 19, 22, 14, 12, 23, 15, 21, 22, 26, 20, 27, 23, 21, 26, 18, 20, 27, 19, 29, 32, 28, 26, 33, 29, 31, 34, 26, 24, 35, 27, 33, 36, 32, 34, 37, 33, 39, 38, 30, 32, 39, 31, 41, 44, 40, 38, 45, 41, 43, 46, 38, 36, 47, 39, 45, 36, 48, 46, 37, 49, 51, 34, 50, 36, 35, 51, 53, 24, 52, 34, 25, 53, 55, 22, 54, 24, 23, 55, 57, 22, 58, 56, 59, 23, 57, 12, 62, 58, 63, 13, 59, 10, 64, 62, 65, 11, 63, 0, 48, 64, 49, 1, 65, 60, 64, 48, 49, 65, 61, 62, 64, 60, 61, 65, 63, 60, 58, 62, 63, 59, 61, 60, 56, 58, 59, 57, 61, 60, 54, 56, 57, 55, 61, 60, 52, 54, 55, 53, 61, 60, 50, 52, 53, 51, 61, 60, 48, 50, 51, 49, 61, 173, 90, 88, 174, 90, 175, 171, 88, 86, 172, 89, 174, 84, 171, 86, 172, 85, 87, 82, 169, 84, 170, 83, 85, 80, 167, 82, 168, 81, 83, 78, 145, 163, 146, 79, 164, 93, 145, 91, 94, 146, 148, 93, 149, 147, 150, 94, 148, 97, 149, 95, 98, 150, 152, 99, 151, 97, 100, 152, 154, 101, 153, 99, 102, 154, 156, 101, 157, 155, 158, 102, 156, 105, 157, 103, 106, 158, 160, 107, 159, 105, 108, 160, 162, 66, 161, 107, 66, 162, 67, 127, 161, 109, 128, 162, 160, 127, 157, 159, 158, 128, 160, 155, 178, 125, 156, 179, 158, 153, 125, 123, 154, 126, 156, 151, 123, 121, 152, 124, 154, 149, 121, 119, 150, 122, 152, 147, 119, 117, 148, 120, 150, 145, 117, 115, 146, 118, 148, 113, 145, 115, 146, 114, 116, 113, 176, 163, 176, 114, 164, 161, 111, 109, 162, 112, 67, 111, 177, 182, 177, 112, 183, 180, 177, 176, 181, 177, 183, 134, 175, 173, 175, 135, 174, 132, 173, 171, 174, 133, 172, 132, 169, 130, 133, 170, 172, 165, 184, 167, 185, 166, 168, 130, 167, 184, 168, 131, 185, 189, 186, 143, 189, 187, 188, 186, 68, 184, 187, 68, 188, 130, 68, 129, 131, 68, 185, 141, 190, 143, 191, 142, 144, 194, 141, 139, 195, 142, 193, 196, 139, 138, 197, 140, 195, 70, 138, 137, 70, 138, 197, 143, 69, 189, 144, 69, 191, 190, 207, 69, 191, 207, 206, 70, 199, 196, 200, 70, 197, 196, 201, 194, 202, 197, 195, 201, 192, 194, 202, 193, 204, 192, 205, 190, 206, 193, 191, 203, 199, 198, 204, 200, 202, 198, 205, 203, 206, 198, 204, 138, 163, 176, 164, 138, 176, 139, 210, 163, 211, 140, 164, 143, 210, 141, 144, 211, 213, 186, 212, 143, 187, 213, 166, 208, 165, 80, 209, 166, 213, 214, 212, 208, 215, 213, 211, 78, 210, 214, 211, 79, 215, 129, 221, 130, 129, 222, 71, 132, 221, 219, 222, 133, 220, 134, 219, 217, 220, 135, 218, 136, 217, 216, 218, 136, 216, 217, 230, 216, 218, 230, 229, 217, 226, 228, 227, 218, 229, 219, 224, 226, 225, 220, 227, 71, 224, 221, 71, 225, 223, 223, 228, 224, 229, 223, 225, 224, 228, 226, 227, 229, 225, 182, 233, 231, 234, 183, 232, 111, 231, 253, 232, 112, 254, 111, 255, 109, 112, 256, 254, 113, 233, 180, 114, 234, 252, 113, 249, 251, 250, 114, 252, 115, 247, 249, 248, 116, 250, 117, 245, 247, 246, 118, 248, 119, 243, 245, 244, 120, 246, 123, 243, 121, 124, 244, 242, 125, 241, 123, 126, 242, 240, 125, 235, 239, 236, 126, 240, 178, 237, 235, 238, 179, 236, 127, 255, 237, 256, 128, 238, 237, 257, 275, 258, 238, 276, 235, 275, 277, 276, 236, 278, 235, 273, 239, 236, 274, 278, 239, 271, 241, 240, 272, 274, 243, 271, 269, 272, 244, 270, 243, 267, 245, 244, 268, 270, 247, 267, 265, 268, 248, 266, 247, 263, 249, 248, 264, 266, 249, 261, 251, 250, 262, 264, 233, 261, 279, 262, 234, 280, 255, 259, 257, 260, 256, 258, 253, 281, 259, 282, 254, 260, 231, 279, 281, 280, 232, 282, 66, 283, 72, 284, 66, 72, 107, 285, 283, 286, 108, 284, 103, 285, 105, 104, 286, 288, 101, 287, 103, 102, 288, 290, 99, 289, 101, 100, 290, 292, 99, 293, 291, 294, 100, 292, 95, 293, 97, 96, 294, 296, 95, 297, 295, 298, 96, 296, 93, 299, 297, 300, 94, 298, 308, 337, 307, 308, 338, 328, 307, 335, 306, 307, 336, 338, 306, 339, 305, 306, 340, 336, 88, 305, 339, 305, 89, 340, 86, 339, 333, 340, 87, 334, 84, 333, 329, 334, 85, 330, 82, 329, 331, 330, 83, 332, 329, 337, 331, 338, 330, 332, 333, 335, 329, 334, 336, 340, 331, 327, 325, 332, 328, 338, 80, 331, 325, 332, 81, 326, 341, 214, 208, 342, 215, 344, 325, 208, 80, 326, 209, 342, 214, 345, 78, 215, 346, 344, 345, 91, 78, 346, 92, 300, 323, 303, 76, 324, 303, 352, 351, 77, 303, 352, 77, 350, 77, 347, 304, 348, 77, 304, 304, 327, 308, 328, 304, 308, 327, 341, 325, 328, 342, 348, 295, 317, 309, 318, 296, 310, 315, 76, 75, 316, 76, 324, 357, 302, 301, 358, 302, 356, 302, 353, 74, 354, 302, 74, 74, 315, 75, 316, 74, 75, 291, 361, 363, 362, 292, 364, 363, 367, 365, 368, 364, 366, 365, 369, 371, 370, 366, 372, 371, 375, 373, 376, 372, 374, 377, 375, 313, 378, 376, 374, 315, 373, 377, 374, 316, 378, 353, 371, 373, 372, 354, 374, 355, 365, 371, 366, 356, 372, 357, 363, 365, 364, 358, 366, 291, 359, 289, 292, 360, 364, 359, 301, 73, 360, 301, 358, 285, 289, 283, 286, 290, 288, 283, 359, 73, 360, 284, 73, 72, 283, 73, 73, 284, 72, 295, 361, 293, 296, 362, 310, 309, 367, 361, 368, 310, 362, 311, 369, 367, 370, 312, 368, 375, 381, 313, 376, 382, 370, 349, 383, 347, 350, 384, 386, 383, 319, 317, 384, 320, 386, 297, 383, 317, 384, 298, 318, 299, 341, 383, 342, 300, 384, 341, 347, 383, 384, 348, 342, 299, 345, 343, 344, 346, 300, 321, 377, 313, 322, 378, 380, 377, 323, 315, 378, 324, 380, 385, 321, 319, 386, 322, 380, 351, 385, 349, 352, 386, 380, 323, 379, 351, 352, 380, 324, 387, 401, 399, 388, 402, 414, 399, 403, 397, 404, 400, 398, 403, 395, 397, 404, 396, 406, 405, 393, 395, 406, 394, 408, 407, 391, 393, 408, 392, 410, 391, 411, 389, 412, 392, 390, 409, 417, 411, 418, 410, 412, 407, 419, 409, 420, 408, 410, 423, 407, 405, 424, 408, 422, 425, 405, 403, 426, 406, 424, 427, 403, 401, 428, 404, 426, 401, 415, 427, 416, 402, 428, 319, 441, 317, 320, 442, 444, 389, 443, 319, 390, 444, 412, 309, 441, 311, 442, 310, 312, 381, 413, 387, 414, 382, 388, 411, 439, 443, 440, 412, 444, 445, 439, 437, 446, 440, 444, 433, 437, 435, 438, 434, 436, 447, 433, 431, 448, 434, 446, 447, 449, 429, 448, 450, 432, 429, 415, 413, 430, 416, 450, 447, 381, 311, 448, 382, 430, 441, 447, 311, 442, 448, 446, 441, 443, 445, 446, 444, 442, 415, 451, 475, 452, 416, 476, 431, 451, 449, 432, 452, 462, 431, 459, 461, 460, 432, 462, 435, 459, 433, 436, 460, 458, 437, 457, 435, 438, 458, 456, 437, 453, 455, 454, 438, 456, 439, 473, 453, 474, 440, 454, 427, 475, 463, 476, 428, 464, 425, 463, 465, 464, 426, 466, 423, 465, 467, 466, 424, 468, 423, 469, 421, 424, 470, 468, 421, 471, 419, 422, 472, 470, 419, 473, 417, 420, 474, 472, 455, 477, 457, 456, 478, 480, 479, 483, 477, 480, 484, 482, 483, 487, 485, 488, 484, 486, 487, 491, 485, 488, 492, 490, 463, 485, 491, 486, 464, 492, 483, 475, 451, 484, 476, 486, 461, 483, 451, 462, 484, 478, 457, 461, 459, 462, 458, 460, 473, 455, 453, 474, 456, 480, 471, 479, 473, 480, 472, 474, 487, 471, 469, 488, 472, 482, 489, 469, 467, 490, 470, 488, 465, 489, 467, 490, 466, 468, 463, 491, 465, 466, 492, 464, 391, 503, 501, 504, 392, 502, 393, 501, 499, 502, 394, 500, 393, 497, 395, 394, 498, 500, 395, 495, 397, 396, 496, 498, 397, 493, 399, 398, 494, 496, 399, 505, 387, 400, 506, 494, 501, 505, 493, 502, 506, 504, 493, 499, 501, 500, 494, 502, 495, 497, 499, 500, 498, 496, 381, 505, 313, 382, 506, 388, 313, 503, 321, 504, 314, 322, 319, 503, 389, 504, 320, 390, 46, 0, 2, 3, 1, 47, 44, 2, 4, 5, 3, 45, 2, 8, 6, 7, 9, 3, 0, 10, 8, 9, 11, 1, 10, 12, 14, 15, 13, 11, 8, 14, 16, 17, 15, 9, 20, 18, 16, 21, 15, 17, 22, 20, 14, 23, 13, 15, 22, 24, 26, 27, 25, 23, 26, 28, 18, 27, 21, 19, 32, 30, 28, 33, 27, 29, 34, 32, 26, 35, 25, 27, 36, 38, 32, 37, 35, 33, 38, 40, 30, 39, 33, 31, 44, 42, 40, 45, 39, 41, 46, 44, 38, 47, 37, 39, 36, 50, 48, 37, 47, 49, 34, 52, 50, 35, 37, 51, 24, 54, 52, 25, 35, 53, 22, 56, 54, 23, 25, 55, 22, 12, 58, 59, 13, 23, 12, 10, 62, 63, 11, 13, 10, 0, 64, 65, 1, 11, 0, 46, 48, 49, 47, 1, 173, 175, 90, 174, 89, 90, 171, 173, 88, 172, 87, 89, 84, 169, 171, 172, 170, 85, 82, 167, 169, 170, 168, 83, 80, 165, 167, 168, 166, 81, 78, 91, 145, 146, 92, 79, 93, 147, 145, 94, 92, 146, 93, 95, 149, 150, 96, 94, 97, 151, 149, 98, 96, 150, 99, 153, 151, 100, 98, 152, 101, 155, 153, 102, 100, 154, 101, 103, 157, 158, 104, 102, 105, 159, 157, 106, 104, 158, 107, 161, 159, 108, 106, 160, 66, 67, 161, 66, 108, 162, 127, 159, 161, 128, 110, 162, 127, 178, 157, 158, 179, 128, 155, 157, 178, 156, 126, 179, 153, 155, 125, 154, 124, 126, 151, 153, 123, 152, 122, 124, 149, 151, 121, 150, 120, 122, 147, 149, 119, 148, 118, 120, 145, 147, 117, 146, 116, 118, 113, 163, 145, 146, 164, 114, 113, 180, 176, 176, 181, 114, 161, 67, 111, 162, 110, 112, 111, 67, 177, 177, 67, 112, 180, 182, 177, 181, 176, 177, 134, 136, 175, 175, 136, 135, 132, 134, 173, 174, 135, 133, 132, 171, 169, 133, 131, 170, 165, 186, 184, 185, 187, 166, 130, 169, 167, 168, 170, 131, 189, 188, 186, 189, 144, 187, 186, 188, 68, 187, 185, 68, 130, 184, 68, 131, 129, 68, 141, 192, 190, 191, 193, 142, 194, 192, 141, 195, 140, 142, 196, 194, 139, 197, 138, 140, 70, 196, 138, 143, 190, 69, 144, 189, 69, 190, 205, 207, 191, 69, 207, 70, 198, 199, 200, 198, 70, 196, 199, 201, 202, 200, 197, 201, 203, 192, 202, 195, 193, 192, 203, 205, 206, 204, 193, 203, 201, 199, 204, 198, 200, 198, 207, 205, 206, 207, 198, 138, 139, 163, 164, 140, 138, 139, 141, 210, 211, 142, 140, 143, 212, 210, 144, 142, 211, 186, 165, 212, 187, 144, 213, 208, 212, 165, 209, 81, 166, 214, 210, 212, 215, 209, 213, 78, 163, 210, 211, 164, 79, 129, 71, 221, 129, 131, 222, 132, 130, 221, 222, 131, 133, 134, 132, 219, 220, 133, 135, 136, 134, 217, 218, 135, 136, 217, 228, 230, 218, 216, 230, 217, 219, 226, 227, 220, 218, 219, 221, 224, 225, 222, 220, 71, 223, 224, 71, 222, 225, 223, 230, 228, 229, 230, 223, 182, 180, 233, 234, 181, 183, 111, 182, 231, 232, 183, 112, 111, 253, 255, 112, 110, 256, 113, 251, 233, 114, 181, 234, 113, 115, 249, 250, 116, 114, 115, 117, 247, 248, 118, 116, 117, 119, 245, 246, 120, 118, 119, 121, 243, 244, 122, 120, 123, 241, 243, 124, 122, 244, 125, 239, 241, 126, 124, 242, 125, 178, 235, 236, 179, 126, 178, 127, 237, 238, 128, 179, 127, 109, 255, 256, 110, 128, 237, 255, 257, 258, 256, 238, 235, 237, 275, 276, 238, 236, 235, 277, 273, 236, 240, 274, 239, 273, 271, 240, 242, 272, 243, 241, 271, 272, 242, 244, 243, 269, 267, 244, 246, 268, 247, 245, 267, 268, 246, 248, 247, 265, 263, 248, 250, 264, 249, 263, 261, 250, 252, 262, 233, 251, 261, 262, 252, 234, 255, 253, 259, 260, 254, 256, 253, 231, 281, 282, 232, 254, 231, 233, 279, 280, 234, 232, 66, 107, 283, 284, 108, 66, 107, 105, 285, 286, 106, 108, 103, 287, 285, 104, 106, 286, 101, 289, 287, 102, 104, 288, 99, 291, 289, 100, 102, 290, 99, 97, 293, 294, 98, 100, 95, 295, 293, 96, 98, 294, 95, 93, 297, 298, 94, 96, 93, 91, 299, 300, 92, 94, 308, 327, 337, 308, 307, 338, 307, 337, 335, 307, 306, 336, 306, 335, 339, 306, 305, 340, 88, 90, 305, 305, 90, 89, 86, 88, 339, 340, 89, 87, 84, 86, 333, 334, 87, 85, 82, 84, 329, 330, 85, 83, 329, 335, 337, 338, 336, 330, 333, 339, 335, 334, 330, 336, 331, 337, 327, 332, 326, 328, 80, 82, 331, 332, 83, 81, 341, 343, 214, 342, 209, 215, 325, 341, 208, 326, 81, 209, 214, 343, 345, 215, 79, 346, 345, 299, 91, 346, 79, 92, 323, 351, 303, 324, 76, 303, 351, 349, 77, 352, 303, 77, 77, 349, 347, 348, 350, 77, 304, 347, 327, 328, 348, 304, 327, 347, 341, 328, 326, 342, 295, 297, 317, 318, 298, 296, 315, 323, 76, 316, 75, 76, 357, 355, 302, 358, 301, 302, 302, 355, 353, 354, 356, 302, 74, 353, 315, 316, 354, 74, 291, 293, 361, 362, 294, 292, 363, 361, 367, 368, 362, 364, 365, 367, 369, 370, 368, 366, 371, 369, 375, 376, 370, 372, 377, 373, 375, 378, 314, 376, 315, 353, 373, 374, 354, 316, 353, 355, 371, 372, 356, 354, 355, 357, 365, 366, 358, 356, 357, 359, 363, 364, 360, 358, 291, 363, 359, 292, 290, 360, 359, 357, 301, 360, 73, 301, 285, 287, 289, 286, 284, 290, 283, 289, 359, 360, 290, 284, 295, 309, 361, 296, 294, 362, 309, 311, 367, 368, 312, 310, 311, 381, 369, 370, 382, 312, 375, 369, 381, 376, 314, 382, 349, 385, 383, 350, 348, 384, 383, 385, 319, 384, 318, 320, 297, 299, 383, 384, 300, 298, 299, 343, 341, 342, 344, 300, 321, 379, 377, 322, 314, 378, 377, 379, 323, 378, 316, 324, 385, 379, 321, 386, 320, 322, 351, 379, 385, 352, 350, 386, 387, 413, 401, 388, 400, 402, 399, 401, 403, 404, 402, 400, 403, 405, 395, 404, 398, 396, 405, 407, 393, 406, 396, 394, 407, 409, 391, 408, 394, 392, 391, 409, 411, 412, 410, 392, 409, 419, 417, 418, 420, 410, 407, 421, 419, 420, 422, 408, 423, 421, 407, 424, 406, 408, 425, 423, 405, 426, 404, 406, 427, 425, 403, 428, 402, 404, 401, 413, 415, 416, 414, 402, 319, 443, 441, 320, 318, 442, 389, 411, 443, 390, 320, 444, 309, 317, 441, 442, 318, 310, 381, 429, 413, 414, 430, 382, 411, 417, 439, 440, 418, 412, 445, 443, 439, 446, 438, 440, 433, 445, 437, 438, 446, 434, 447, 445, 433, 448, 432, 434, 447, 431, 449, 448, 430, 450, 429, 449, 415, 430, 414, 416, 447, 429, 381, 448, 312, 382, 441, 445, 447, 442, 312, 448, 415, 449, 451, 452, 450, 416, 431, 461, 451, 432, 450, 452, 431, 433, 459, 460, 434, 432, 435, 457, 459, 436, 434, 460, 437, 455, 457, 438, 436, 458, 437, 439, 453, 454, 440, 438, 439, 417, 473, 474, 418, 440, 427, 415, 475, 476, 416, 428, 425, 427, 463, 464, 428, 426, 423, 425, 465, 466, 426, 424, 423, 467, 469, 424, 422, 470, 421, 469, 471, 422, 420, 472, 419, 471, 473, 420, 418, 474, 455, 479, 477, 456, 458, 478, 479, 481, 483, 480, 478, 484, 483, 481, 487, 488, 482, 484, 487, 489, 491, 488, 486, 492, 463, 475, 485, 486, 476, 464, 483, 485, 475, 484, 452, 476, 461, 477, 483, 462, 452, 484, 457, 477, 461, 462, 478, 458, 473, 479, 455, 474, 454, 456, 471, 481, 479, 480, 482, 472, 487, 481, 471, 488, 470, 472, 489, 487, 469, 490, 468, 470, 465, 491, 489, 490, 492, 466, 391, 389, 503, 504, 390, 392, 393, 391, 501, 502, 392, 394, 393, 499, 497, 394, 396, 498, 395, 497, 495, 396, 398, 496, 397, 495, 493, 398, 400, 494, 399, 493, 505, 400, 388, 506, 501, 503, 505, 502, 494, 506, 493, 495, 499, 500, 496, 494, 381, 387, 505, 382, 314, 506, 313, 505, 503, 504, 506, 314, 319, 321, 503, 504, 322, 320};
    // clang-format on
    rt_hittable_t *monkey_mesh = rt_instance_new(
        rt_triangle_mesh_new(vertices, sizeof(vertices) / sizeof(vertices[0]), triangles, triangle_count, green));
    rt_instance_rotate_y(monkey_mesh, 215);
    rt_instance_translate(monkey_mesh, vec3(0, -1, 3));
    rt_hittable_list_add(objects, monkey_mesh);

    return objects;
}

typedef struct rt_scenes_s
{
    rt_scene_id_t id;
    const char *name;
    const char *desc;
} rt_scenes_t;

static rt_scenes_t gs_scenes[] = {
    {RT_SCENE_RANDOM, "random_spheres", "Scene from \'Ray Tracing In One Weekend\' cover (with checker texture)"},
    {RT_SCENE_TWO_SPHERES, "two_spheres", "Two checkered spheres"},
    {RT_SCENE_TWO_PERLIN_SPHERES, "perlin_spheres", "Two spheres with Perlin-based textures"},
    {RT_SCENE_EARTH, "earth", "Sphere with Earth texture"},
    {RT_SCENE_LIGHT_SAMPLE, "light_sample", "Sphere with a light source near it"},
    {RT_SCENE_CORNELL_BOX, "cornell_box", "Cornell box scene"},
    {RT_SCENE_INSTANCE_TEST, "instance_test", "Several rotated and translated cubes"},
    {RT_SCENE_CORNELL_SMOKE, "cornell_smoke", "Cornell box scene but boxes as made of smoke"},
    {RT_SCENE_SHOWCASE, "showcase", "Scene from \'Ray Tracing: The Next Week\' cover"},
    {RT_SCENE_METAL_TEST, "metal_test", "Test for metal texture (several metal spheres)"},
    {RT_SCENE_TRIANGLE_TEST, "triangle_test", "Test for triangle objects"},
};

rt_scene_id_t rt_scene_get_id_by_name(const char *name)
{
    if (NULL == name)
    {
        return RT_SCENE_NONE;
    }

    for (int i = 0; i < sizeof(gs_scenes) / sizeof(gs_scenes[0]); ++i)
    {
        if (0 == strcmp(gs_scenes[i].name, name))
        {
            return gs_scenes[i].id;
        }
    }

    return RT_SCENE_NONE;
}

const char *rt_scene_get_name_by_id(rt_scene_id_t scene_id)
{
    for (int i = 0; i < sizeof(gs_scenes) / sizeof(gs_scenes[0]); ++i)
    {
        if (gs_scenes[i].id == scene_id)
        {
            return gs_scenes[i].name;
        }
    }

    return NULL;
}

void rt_scene_print_scenes_info(FILE *to)
{
    assert(NULL != to);

    for (int i = 0; i < sizeof(gs_scenes) / sizeof(gs_scenes[0]); ++i)
    {
        fprintf(to, "\t%-30s  %s\n", gs_scenes[i].name, gs_scenes[i].desc);
    }
}
